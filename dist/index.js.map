{"version":3,"file":"index.js","sources":["../src/ioc.ts","../src/subjects.ts","../src/Provider.tsx","../src/reactivex/Observer.ts","../src/reactivex/Subject.ts","../src/reactivex/BehaviorSubject.ts","../src/Context.ts","../src/Listener.ts","../src/Consumer.tsx"],"sourcesContent":["export default {\n  data: {},\n\n  get(key: string) {\n    return this.data[key];\n  },\n\n  register(key: string, value) {\n    this.data[key] = value;\n  },\n};\n","import Subject from './reactivex/Subject';\n\nexport interface ISubjects {\n  data: {[key: string]: Subject<any> };\n  get(registName: string): Subject<any>;\n  set(registName: string, subject: Subject<any>): void;\n}\n\nconst subjects: ISubjects = {\n  data: {},\n\n  get(registName: string) {\n    return this.data[registName];\n  },\n\n  set(registName: string, subject: Subject<any>) {\n    if (typeof this.data[registName] !== 'undefined') {\n      throw new Error(`${registName} is already exists.`);\n    } else {\n      this.data[registName] = subject;\n    }\n  },\n};\n\nexport default subjects;\n","import React, {Component, createContext} from 'react';\nimport ioc from './ioc';\nimport subjects from './subjects';\n\nexport const Provider = (name: string) => {\n  if (typeof ioc.get(name) !== 'undefined') {\n    throw new Error(`${name} is already regist.`);\n  }\n\n  const Context = createContext({});\n  ioc.register(name, Context);\n\n  return  (Cmpt) => {\n\n    return class Regist extends Component<any> {\n      public state = {\n        context: {},\n      };\n\n      public componentDidMount() {\n        const subject$ = subjects.get(Cmpt.name);\n        subject$.subscribe((data) => {\n          this.setState({\n            context: data,\n          });\n        });\n      }\n\n      public render() {\n        return (\n          <Context.Provider value={this.state.context}>\n            <Cmpt {...this.props}/>\n          </Context.Provider>\n        );\n      }\n    };\n\n  };\n\n};\n","export interface IDestination<T> {\n  next?: (value: T) => void;\n  error?: (err: any) => void;\n  complete?: () => void;\n}\n\nexport default class Observer<T> {\n\n  public destination: IDestination<T>;\n  private isStopped = false;\n\n  constructor(destinationOrNext: (args: any) => void) {\n    this.destination = this.safeObserver(destinationOrNext);\n  }\n\n  public safeObserver(observerOrNext: (value: T) => void): IDestination<T> {\n    return {\n      next: observerOrNext,\n    };\n  }\n\n  public next(args: T) {\n    if (!this.isStopped && this.next) {\n      try {\n        this.destination.next(args); // send next\n      } catch (err) {\n        this.unsubscribe();\n        throw err;\n      }\n    }\n  }\n\n  public error(err) {\n    if (!this.isStopped && this.error) {\n      try {\n        this.destination.error(err); // send error\n      } catch (anotherError) {\n        this.unsubscribe();\n        throw anotherError;\n      }\n      this.unsubscribe();\n    }\n  }\n\n  public complete() {\n    if (!this.isStopped && this.complete) {\n      // 先判斷是否停止過\n      try {\n        this.destination.complete(); // send complete\n      } catch (err) {\n        this.unsubscribe();\n        throw err;\n      }\n      this.unsubscribe(); // unsubscribe after send complete\n    }\n  }\n\n  public unsubscribe() {\n    this.isStopped = true;\n  }\n\n}\n","import Observer from './Observer';\n\nexport default class Subject<T> {\n  public closed = false;\n\n  private observers: Array<Observer<T>> = [];\n\n  public next(args?: T) {\n    if (!this.closed) {\n      this.observers.forEach((observer) => observer.next(args));\n    }\n  }\n\n  public subscribe(observerOrNext: (args: T) => void) {\n    const observer = new Observer<T>(observerOrNext);\n    this.observers.push(observer);\n    return observer;\n  }\n\n  public unsubscribe() {\n    this.closed = true;\n  }\n}\n","import Subject from './Subject';\n\nexport default class BehaviorSubject<T> extends Subject<T> {\n\n  constructor(private store: T) {\n    super();\n  }\n\n  get value(): T {\n    return this.getValue();\n  }\n\n  public getValue(): T {\n   if (this.closed) {\n      throw new Error('subject has been closed.');\n    } else {\n      return this.store;\n    }\n  }\n\n  public next(value: T): void {\n    this.store = value;\n    super.next(value);\n  }\n\n  public subscribe(observerOrNext: (args: T) => void) {\n    const observer = super.subscribe(observerOrNext);\n    observer.next(this.store);\n    return observer;\n  }\n}\n","import BehaviorSubject from './reactivex/BehaviorSubject';\nimport subjects from './subjects';\n\nexport const Context = (target: any, key: string, descriptor: any ) => {\n\n  const name = target.constructor.name;\n  let value = descriptor.initializer();\n\n  if (!subjects.get(name)) {\n    subjects.set(name, new BehaviorSubject({}));\n  }\n\n  const bs$ = subjects.get(name);\n\n  function update(vs: any) {\n    const context$$ = bs$.subscribe((v) => {\n      if (v[key] !== vs) {\n        bs$.next(Object.assign({}, v, {[key]: vs}));\n      }\n    });\n    context$$.unsubscribe();\n  }\n\n  update(value);\n\n  const get = () => {\n    return value;\n  };\n\n  const set = (newVal: any) => {\n    update(newVal);\n    value = newVal;\n  };\n\n  return {\n    configurable: true,\n    enumerable: false,\n    get,\n    set,\n  };\n\n};\n","import BehaviorSubject from './reactivex/BehaviorSubject';\nimport Subject from './reactivex/Subject';\nimport subjects from './subjects';\n\nexport const Listener = (target: any, key: string) => {\n  const name = target.constructor.name;\n\n  if (!subjects.get(name)) {\n    subjects.set(name, new BehaviorSubject({}));\n  }\n\n  const bs$ = subjects.get(name);\n  const keySub$ = new Subject();\n\n  const bs$$ = bs$.subscribe((v) => {\n    function update(args) {\n      keySub$.next(args);\n    }\n\n    if (typeof v[key] === 'undefined') {\n      bs$.next(Object.assign({}, v, { [key]: update }));\n    }\n  });\n\n  bs$$.unsubscribe();\n\n  const get = () => {\n    return keySub$;\n  };\n\n  const set = () => {\n    // tslint:disable-next-line\n    console.log(`can note set listen: ${key}, it's readonly.`);\n  };\n\n  return {\n    configurable: true,\n    enumerable: false,\n    get,\n    set,\n  };\n\n};\n","import React, { Component } from 'react';\nimport ioc from './ioc';\n\nexport const Consumer = (name: string, dependencies?: string[]) => {\n\n  return (Cmpt) => {\n\n    return class Instance extends Component<any> {\n\n      public renderContext = (context) => {\n        let props = {};\n\n        if (dependencies) {\n          dependencies.forEach((key) => {\n            props[key] = context[key];\n          });\n        } else {\n          props = context;\n        }\n\n        return <Cmpt {...props} />;\n      }\n\n      public render() {\n        const Context = ioc.get(name);\n\n        if (Context) {\n          return <Context.Consumer>{this.renderContext}</Context.Consumer>;\n        }\n\n        return null;\n      }\n\n    };\n  };\n\n};\n"],"names":["createContext","Component","React"],"mappings":"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"}