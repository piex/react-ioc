{"version":3,"file":"index.js","sources":["../src/ioc.js","../src/subjects.js","../src/Provider.js","../src/Context.js","../src/Listener.js","../src/Consumer.js"],"sourcesContent":["export default {\n  data: {},\n\n  get(key) {\n    return this.data[key]\n  },\n\n  register(key, value) {\n    this.data[key] = value;\n  }\n}","export default {\n  data:{},\n\n  get(className) {\n    return this.data[className];\n  },\n\n  set(className, value) {\n    if(typeof this.data[className] != 'undefined') {\n      throw new Error(`${className} is already exists.`)\n     } else {\n      this.data[className] = value;\n     }\n  }\n}","import React, { Component, createContext } from 'react';\nimport ioc from './ioc';\nimport subjects from './subjects';\n\nexport const Provider = name => {\n\n  if(typeof ioc.get(name) !== 'undefined') {\n    throw new Error(`${name} 已被注册！`);\n  }\n\n  const Context = createContext({});\n  ioc.register(name, Context);\n\n  return Cmpt => {\n\n    return class Regist extends Component {\n      state = {\n        context: {}\n      }\n\n      componentDidMount() {\n        subjects.get(Cmpt.name).subscribe(data=>{\n          this.setState({\n            context: data\n          })\n        }) \n      }\n\n      render() {\n        return (\n          <Context.Provider value={this.state.context}>\n            <Cmpt {...this.props}/>\n          </Context.Provider>\n          )\n      }\n    } \n\n  }\n\n}","import { BehaviorSubject } from 'rxjs';\nimport subjects from './subjects';\n\nexport const Context = (target, key, descriptor) => {\n\n  const name = target.constructor.name;\n  let value = descriptor.initializer();\n\n\n  if(!subjects.get(name)) {\n    const bs$ = new BehaviorSubject({})\n    subjects.set(name, bs$)\n  }\n\n  const bs$ = subjects.get(name);\n\n  function update(value) {\n    const context$$ = bs$.subscribe(v => {\n      if(v[key] !== value) {\n        bs$.next(Object.assign({}, v, { [key]: value }))\n      }\n    })\n    context$$.unsubscribe();\n  }\n\n  // init context\n  update(value);\n\n  const get = function () {\n    return value;\n  }\n\n  const set = newVal => {\n    update(newVal);\n    value = newVal;\n  }\n\n  return {\n    get,\n    set,\n    enumerable: false,\n    configurable: true,\n  }\n}","import { BehaviorSubject, Subject } from 'rxjs';\n\nimport subjects from './subjects';\n\nexport const Listener = (target, key) => {\n\n  const name = target.constructor.name;\n\n  if(!subjects.get(name)) {\n    const bs$ = new BehaviorSubject({})\n    subjects.set(name, bs$)\n  }\n\n  const bs$ = subjects.get(name);\n  const keySub$ = new Subject();\n\n  const bs$$ = bs$.subscribe(v => {\n    function update(...args) {\n      keySub$.next(...args);\n    }\n    bs$.next(Object.assign({}, v, { [key]: update }))\n  })\n\n  bs$$.unsubscribe();\n\n  const get = function () {\n    return keySub$;\n  }\n\n  const set = () => {\n    console.log(`can note set listen: ${key}, it's readonly.`)\n  }\n\n  return {\n    get,\n    set,\n    enumerable: false,\n    configurable: true,\n  }\n}","import React, { Component } from 'react';\nimport ioc from './ioc';\n\nexport const Consumer = (name, dependencies) => {\n\n  return Cmpt => {\n    return class Ins extends Component {\n\n      renderContext = context => {\n        let props = {};\n\n        if(dependencies) {\n          dependencies.forEach(key=>{\n            props[key] = context[key];\n          });\n        } else {\n          props = context;\n        }\n\n        return <Cmpt {...props}/>\n      }\n\n      render() {\n        const Context = ioc.get(name);\n\n        if(Context) {\n          return (\n            <Context.Consumer>\n            {this.renderContext}\n          </Context.Consumer>\n          )\n        }\n\n        return null;\n      }\n    }\n  }\n}"],"names":["createContext","tslib_1.__extends","React","Component","BehaviorSubject","Subject"],"mappings":"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"}