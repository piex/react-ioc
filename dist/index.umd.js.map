{"version":3,"file":"index.umd.js","sources":["../src/ioc.ts","../src/subjects.ts","../src/Provider.tsx","../src/reactivex/Observer.ts","../src/reactivex/Subject.ts","../src/reactivex/BehaviorSubject.ts","../src/Context.ts","../src/Listener.ts","../src/Consumer.tsx"],"sourcesContent":["export default {\n  data: {},\n\n  get(key: string) {\n    return this.data[key];\n  },\n\n  register(key: string, value) {\n    this.data[key] = value;\n  },\n};\n","import Subject from './reactivex/Subject';\n\nexport interface ISubjects {\n  data: {[key: string]: Subject<any> };\n  get(registName: string): Subject<any>;\n  set(registName: string, subject: Subject<any>): void;\n}\n\nconst subjects: ISubjects = {\n  data: {},\n\n  get(registName: string) {\n    return this.data[registName];\n  },\n\n  set(registName: string, subject: Subject<any>) {\n    if (typeof this.data[registName] !== 'undefined') {\n      throw new Error(`${registName} is already exists.`);\n    } else {\n      this.data[registName] = subject;\n    }\n  },\n};\n\nexport default subjects;\n","import React, {Component, createContext} from 'react';\nimport ioc from './ioc';\nimport subjects from './subjects';\n\nexport const Provider = (name: string) => {\n  if (typeof ioc.get(name) !== 'undefined') {\n    throw new Error(`${name} is already regist.`);\n  }\n\n  const Context = createContext({});\n  ioc.register(name, Context);\n\n  return  (Cmpt) => {\n\n    return class Regist extends Component<any> {\n      public state = {\n        context: {},\n      };\n\n      public componentDidMount() {\n        const subject$ = subjects.get(Cmpt.name);\n        subject$.subscribe((data) => {\n          this.setState({\n            context: data,\n          });\n        });\n      }\n\n      public render() {\n        return (\n          <Context.Provider value={this.state.context}>\n            <Cmpt {...this.props}/>\n          </Context.Provider>\n        );\n      }\n    };\n\n  };\n\n};\n","export interface IDestination<T> {\n  next?: (value: T) => void;\n  error?: (err: any) => void;\n  complete?: () => void;\n}\n\nexport default class Observer<T> {\n\n  public destination: IDestination<T>;\n  private isStopped = false;\n\n  constructor(destinationOrNext: (args: any) => void) {\n    this.destination = this.safeObserver(destinationOrNext);\n  }\n\n  public safeObserver(observerOrNext: (value: T) => void): IDestination<T> {\n    return {\n      next: observerOrNext,\n    };\n  }\n\n  public next(args: T) {\n    if (!this.isStopped && this.next) {\n      try {\n        this.destination.next(args); // send next\n      } catch (err) {\n        this.unsubscribe();\n        throw err;\n      }\n    }\n  }\n\n  public error(err) {\n    if (!this.isStopped && this.error) {\n      try {\n        this.destination.error(err); // send error\n      } catch (anotherError) {\n        this.unsubscribe();\n        throw anotherError;\n      }\n      this.unsubscribe();\n    }\n  }\n\n  public complete() {\n    if (!this.isStopped && this.complete) {\n      // 先判斷是否停止過\n      try {\n        this.destination.complete(); // send complete\n      } catch (err) {\n        this.unsubscribe();\n        throw err;\n      }\n      this.unsubscribe(); // unsubscribe after send complete\n    }\n  }\n\n  public unsubscribe() {\n    this.isStopped = true;\n  }\n\n}\n","import Observer from './Observer';\n\nexport default class Subject<T> {\n  public closed = false;\n\n  private observers: Array<Observer<T>> = [];\n\n  public next(args?: T) {\n    if (!this.closed) {\n      this.observers.forEach((observer) => observer.next(args));\n    }\n  }\n\n  public subscribe(observerOrNext: (args: T) => void) {\n    const observer = new Observer<T>(observerOrNext);\n    this.observers.push(observer);\n    return observer;\n  }\n\n  public unsubscribe() {\n    this.closed = true;\n  }\n}\n","import Subject from './Subject';\n\nexport default class BehaviorSubject<T> extends Subject<T> {\n\n  constructor(private store: T) {\n    super();\n  }\n\n  get value(): T {\n    return this.getValue();\n  }\n\n  public getValue(): T {\n   if (this.closed) {\n      throw new Error('subject has been closed.');\n    } else {\n      return this.store;\n    }\n  }\n\n  public next(value: T): void {\n    this.store = value;\n    super.next(value);\n  }\n\n  public subscribe(observerOrNext: (args: T) => void) {\n    const observer = super.subscribe(observerOrNext);\n    observer.next(this.store);\n    return observer;\n  }\n}\n","import BehaviorSubject from './reactivex/BehaviorSubject';\nimport subjects from './subjects';\n\nexport const Context = (target: any, key: string, descriptor: any ) => {\n\n  const name = target.constructor.name;\n  let value = descriptor.initializer();\n\n  if (!subjects.get(name)) {\n    subjects.set(name, new BehaviorSubject({}));\n  }\n\n  const bs$ = subjects.get(name);\n\n  function update(vs: any) {\n    const context$$ = bs$.subscribe((v) => {\n      if (v[key] !== vs) {\n        bs$.next(Object.assign({}, v, {[key]: vs}));\n      }\n    });\n    context$$.unsubscribe();\n  }\n\n  update(value);\n\n  const get = () => {\n    return value;\n  };\n\n  const set = (newVal: any) => {\n    update(newVal);\n    value = newVal;\n  };\n\n  return {\n    configurable: true,\n    enumerable: false,\n    get,\n    set,\n  };\n\n};\n","import BehaviorSubject from './reactivex/BehaviorSubject';\nimport Subject from './reactivex/Subject';\nimport subjects from './subjects';\n\nexport const Listener = (target: any, key: string) => {\n  const name = target.constructor.name;\n\n  if (!subjects.get(name)) {\n    subjects.set(name, new BehaviorSubject({}));\n  }\n\n  const bs$ = subjects.get(name);\n  const keySub$ = new Subject();\n\n  const bs$$ = bs$.subscribe((v) => {\n    function update(args) {\n      keySub$.next(args);\n    }\n\n    if (typeof v[key] === 'undefined') {\n      bs$.next(Object.assign({}, v, { [key]: update }));\n    }\n  });\n\n  bs$$.unsubscribe();\n\n  const get = () => {\n    return keySub$;\n  };\n\n  const set = () => {\n    // tslint:disable-next-line\n    console.log(`can note set listen: ${key}, it's readonly.`);\n  };\n\n  return {\n    configurable: true,\n    enumerable: false,\n    get,\n    set,\n  };\n\n};\n","import React, { Component } from 'react';\nimport ioc from './ioc';\n\nexport const Consumer = (name: string, dependencies?: string[]) => {\n\n  return (Cmpt) => {\n\n    return class Instance extends Component<any> {\n\n      public renderContext = (context) => {\n        let props = {};\n\n        if (dependencies) {\n          dependencies.forEach((key) => {\n            props[key] = context[key];\n          });\n        } else {\n          props = context;\n        }\n\n        return <Cmpt {...props} />;\n      }\n\n      public render() {\n        const Context = ioc.get(name);\n\n        if (Context) {\n          return <Context.Consumer>{this.renderContext}</Context.Consumer>;\n        }\n\n        return null;\n      }\n\n    };\n  };\n\n};\n"],"names":["createContext","Component","React"],"mappings":"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"}